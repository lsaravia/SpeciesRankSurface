# A new method to analyze species abundances in space using generalized dimensions

**Leonardo A. Saravia**, Ph.D.

Instituto de Ciencias Básicas

Universidad Nacional de General Sarmiento

J.M. Gutierrez 1159 (1613), Los Polvorines

Buenos Aires, Argentina.

<lsaravia@ungs.edu.ar>

\newpage

## Abstract

* Species-area relationships (SAR) and species abundance distributions (SAD) are among the most studied patterns in ecology, due to their application to both theoretical and conservation issues. One problem with these general patterns is that different theories can generate the same predictions, and for this reason they cannot be used to detect different mechanisms of community assembly. 

* A solution is to search for more sensitive patterns, for example by extending the SAR to the whole species abundance distribution. A generalized dimension ($D_q$) approach has been proposed to study the scaling of SAD, but to date there has been no evaluation of the ability of this pattern to detect different mechanisms.

* An equivalent way to express SAD is the rank abundance distribution (RAD). Here I introduce a new way to study SAD scaling using a spatial version of RAD: the species-rank surface (SRS), which can be analyzed using $D_q$. Thus there is an old $D_q$ based on SAR ($D_q^{SAD}$), and a new one based on SRS ($D_q^{SRS}$). I perform spatial simulations to examine the relationship of $D_q$ with SAD, spatial patterns and number of species. Finally I compare the power of both $D_q$, SAD, SAR exponent, and the fractal information dimension to detect different community patterns using a continuum of hierarchical and neutral spatially explicit models.

* The SAD, $D_q^{SAD}$ and $D_q^{SRS}$ all had good performance in detecting models with contrasting mechanisms. $D_q^{SRS}$, however, had a better fit to data and allowed comparisons between hierarchical communities where the other methods failed. The SAR exponent and information dimension had low power and should not be used.

* SRS and $D_q^{SRS}$ could be interesting methods to study community or macroecological patterns.


Keywords: multifractals, species-rank surface, species-area relationship, multi-species spatial pattern.


\newpage
	
## Introduction

The species-area relationship (SAR) is considered one of the oldest and best-documented patterns, and one of a few fundamental generalizations, in ecology [@Sizling2011; @Crawley2001]. The SAR is often characterized by a triphasic curve, with a range of intermediate scales corresponding to power law relationship between the number of species and the area in which they occur [@Preston1960; @Hubbell2001]. Although other quantitative forms could also be appropriate [@Tjorve2003; @White2010a] this power-law is widely accepted [@Rosindell2007], and implies a self-similar or fractal structure of species distributions for a community across spatial scales [@Sizling2004]. 

SARs only give information about the changes of richness with scale, but can be extended by incorporating the species abundances distribution (SAD), using Hill's generalized diversity indices [@Hill1973], which follow from the definition of generalized entropies used in statistical physics, called Renyi's entropies [@Renyi1970]. The scaling exponents of Renyi's entropies are called generalized dimensions, and are used in physics to characterize multifractals [@Beck1990]. Multifractals and fractals are related techniques first used in physics to characterize scaling behavior of complex structures [@Stanley1988]; the difference is that fractals look at the geometry of presence/absence patterns, while multifractals describe the arrangement of quantities such as population density or biomass [@Saravia2012a]. Multifractal analysis has been applied to ecology in different areas: metapopulation models [@Gamarra2005], analysis of natural landscapes [@Kirkpatrick2005], search patterns in copepods [@Seuront2014], and biomass dynamics in microalgae [@DalBello2014; @Saravia2012a; @Seuront2002].   

The application of generalized dimensions to extend SAR was first suggested by Ricotta [-@Ricotta2000], and the methodology was later developed and applied to Barro Colorado Island forest plots by Borda-de-Água et al.[-@Borda-de-Agua2002], who estimated generalized dimensions of SAD. Since then, several field studies have characterized species abundance scaling---also called the species diversity-area relationship (DAR)---using generalized dimensions and other multifractal techniques [@Yakimov2008; @Zhang2006; @Wei2013]. In addition, generalized dimensions have been applied to a spatially explicit neutral model [@Yakimov2014a] and used in open source software for ecological multifractal analysis [@Saravia2014].

The species abundance distribution (SAD) is another fundamental pattern in ecological communities, and plays a major role in ecology and conservation [@Mcgill2007]. SADs have been used to compare different communities and to compare models and data, but is problematic because different mechanisms can produce nearly identical SADs [@Chave2002; @Rosindell2013]. SADs are often presented using rank-abundance diagrams (RADs) in which the log-abundance is plotted against the rank of the species [@Mcgill2007]. RADs are equivalent to cumulative distributions and thus a robust way to visualize the SAD without losing information [@Newman2005]. 

Here I propose a new way to analyze the relation of SAD with spatial scale, by attaching the rank of each species to its spatial distribution; in this way the multivariate spatial distribution of species is summarized into a univariate two-dimensional distribution. I call this spatial distribution the species-rank surface (SRS), and it can be analyzed and compared using generalized dimensions. This paper uses simulations of spatial patterns to compare the behavior of generalized dimensions calculated from SRS and SAD. First I use simple artificial spatial patterns: regular and randomized, combined with a uniform and logseries SAD, to observe the behavior of generalized dimensions. Then I use a continuum of neutral and hierarchical models to test if generalized dimensions can detect different communities, estimating statistical power and type I error rate. I also compare the performance of generalized dimensions with single dimensional indicators (the SAR exponent and the information dimension). A summary of the methods used to compare communities is presented in table 1.   


# Methods

## Multifractal analysis

Extensive reviews of generalized dimensions and multifractal methods applied to ecology are available [@Seuront2009] and some good introductions have also been published [@Scheuring1994; @Borda-de-Agua2007]; thus I will only give a brief description. The generalized dimensions technique analyzes the scaling properties of quantities distributed in a space that we assume to be two-dimensional (i.e., a plane). This distribution should be self-similar across some range of scales, a property called multifractal, and can be mathematically represented in different ways [@Harte2001], of which the closest to ecology are the generalized dimensions $D_q$ [@Grassberger1983], also called Renyi dimensions [@Renyi1970]. $D_q$ has been used to characterize the probabilistic structure of attractors derived from dynamical systems [@Hentschel1983].

I will analyze two kinds of $D_q$: the standard one used to analyze any quantity distributed in space, and another based on the SAD of a community in an area. The first kind is used to analyze the species rank surface SRS (described later) and so is termed $D_q^{SRS}$. The second is based on SAD and named $D_q^{SAD}$. In both cases, I used the method of moments based on box-counting [@Evertsz1992] to estimate generalized dimensions. 

The mathematical representations for $D_q^{SRS}$ and $D_q^{SAD}$ are slightly different. For $D_q^{SRS}$ the spatial distribution of quantities $\mu$ is covered with a grid, dividing it into $N(\epsilon)$ boxes of side  $\epsilon$, allowing us to calculate the value $\mu_i(\epsilon)$ in each. Then the so-called partition function is computed as: 

 (@e1) $Z_q(\epsilon)={\displaystyle \sum_{i}^{N(\epsilon)}} \left(\mu_{i}(\epsilon)\right)^{q}$

Where $q$ can be any real number and is called *moment order*. The operation is performed for different values of $\epsilon$ and $q$, within a predetermined range. The generalized dimension is then calculated as:

 (@e2) $D_q^{SRS}=\cfrac{1}{q-1}\underset{\epsilon\to0}{\lim}\cfrac{\log\left(Z_q(\epsilon)\right)}{\log\epsilon}$

When $q = 1$, the denominator of the first term in $D_q^{SRS}$ is undefined, so it must be replaced by the following expression:

 (@e3) $D_1^{SRS}=\underset{\epsilon\to0}{\lim}\cfrac{{\displaystyle \sum_{i}^{N(\epsilon)}}\mu_{i}(\epsilon)\log\left(\mu_{i}(\epsilon)\right)}{\log\epsilon}$

In practical cases as the limit can not be assessed, and the dimensions are estimated as the slope of the $log(Z_q)$ versus $log(\epsilon)$ in equation (@e1) replacing by the numerator in equation (@e3). This is done for different values of $q$, provided that it is a real number, which yields a graph of $D_q^{SRS}$ in terms of $q$. This graph is called the spectrum of generalized dimensions. 

To be an approximate multifractal, the relationship $log(Z_q)$ versus $log(\epsilon)$ should be well described by a linear relationship, but a linear relationship with superimposed oscillations is also acceptable [@Borda-de-Agua2007]. A range of $q$ and $\epsilon$ values must be established, and then $D_q^{SRS}$ is estimated using linear regression. Note that $D_q^{SRS}$ is defined as the limit ${\epsilon\to0}$ (equations @e2 and @e3), and thus to use the method it is sufficient that a scale exists below which a linear relationship applies [@Hentschel1983]. 

To analyze species-abundance-area relationships with multifractals using the method of Borda-de-Água et al.[-@Borda-de-Agua2002], the boxes are replaced by species. Thus at each spatial scale $\epsilon$ each species holds the quantity of interest: its own abundance. Then the partition function is defined as a sum over the species present $S(A)$ in an area $A$ and the side of the box $\epsilon$ is replaced by the area:

(@e4) $Z_{q}(A)={\displaystyle \sum_{i}^{S(A)}} \left(\mu_{i}(A)\right)^{q}$

where $\mu_{i}(A)$ is the relative abundance of species $i$ in an area $A$. $D_q^{SAD}$ is defined as:

(@e5) $D_q^{SAD}=\cfrac{1}{1-q}\underset{A\to\infty}{\lim}\cfrac{\log\left(\langle Z_{q}(A)\rangle\right)}{\log A}$

The angle brackets indicate averages of $Z_q(A)$ over subplots with area $A$. Thus when I calculate $D_q$ based on species abundances distribution, I refer to it as $D_q^{SAD}$, and when I calculate $D_q$ from the species rank surface, $D_q^{SRS}$; $D_q$ without a superscript refer to both. 

$D_q^{SAD}$ represents the scaling of the Hill's generalized diversity index [@Hill1973]: when the moment order is $q=0$, then $D_q^{SAD}$ becomes the exponent of the SAR power-law scaling; when $q=1$, $D_q^{SAD}$ represent the scaling of Shannon diversity index; and when $q=2$, $D_q^{SAD}$ becomes the scaling of Simpson's index. This is why $D_q^{SAD}$ can characterize diversity-area relationships.

Theoretically $D_q$ must be a non-increasing function of $q$ [@Hentschel1983], which means that if $q_1 \geq q_2$ then $D_{q1} \leq D_{q2}$. Some studies have shown small violations of this property for $D_q^{SAD}$ [@Borda-de-Agua2002; @Zhang2006]. These violations are related to the way that $D_q^{SAD}$ is defined: the summation of equation @e4 is over species, while the summation of the original definition, equation @e1, is over boxes, and this changes the way in which the mathematical limits are taken and also the computation method of $D_q^{SAD}$. A partial solution has been proposed [@Yakimov2014], but the anomalies observed may be related to the mathematical assumptions needed for $D_q$ to be non-increasing, in which case a new mathematical proof should be developed for $D_q^{SAD}$. Thus as long as the linear relationship is reasonable I take $D_q^{SAD}$ as a useful technique of analysis. 

In a previous work I proposed a new way to analyze species-abundance-area relations using multifractals, one that fits more closely to the original definitions of equations @e1 - @e3: the species-rank surface [@Saravia2014] or SRS. To construct the SRS the spatial distribution of species has to be transformed by assigning to each species position its rank. First I use the species abundances, at the whole plot level, to calculate the species' rank ordering from highest to lowest, assigning a number starting with one. If there are species with the same abundance the ranks are assigned at random, and thus all species are present in the surface. Then the rank is assigned to the spatial position of the individuals of each species, forming a surface: a (mathematical) landscape with valleys formed by the most abundant species, and peaks determined by the rarest. Finally the standard multifractal analysis is applied. If sampling was performed using quadrats, without taking the spatial position of individuals, the sum of the ranks of the species in the smallest quadrats can be used to form the SRS. 

The fact that oscillations might be present and the data still accepted as self-similar [@Liebovitch1998] and by extension as multifractal, makes difficult the rejection of a data set based on tests of quadratic trends as proposed by Yakimov et al.[-@Yakimov2008]; this is because the curvature of a quadratic function can be fitted by a periodic function with the correct amplitude. The coefficient of determination ($R^2$) was used as a descriptive measure of goodness of fit for multifractals [@Borda-de-Agua2002]; in general this is not a good indicator of linearity, but since linearity is not exclusively required, I use it here in a descriptive way. The C++ source code to perform the multifractal analysis is available at <https://github.com/lsaravia/mfsba>.

To date no theoretical shape of $D_q$ has been derived for the spatial distributions of species; all that is known is that $D_q$ is bounded such that $D_{\infty}$ and $D_{-\infty}$ exist, and that $D_q$ is a non-increasing function of $q$ and thus that $D_{-\infty} \leq D_{\infty}$. Generalized dimensions ($D_q$) can be interpreted like a SAR power law exponent: with larger values, the change in the number of species is greater when the scale of observation changes to a larger area. $D_q$ expresses the change of the quantity under study when scale changes, but is modulated by $q$. When $q$ is positive the terms of the sums (equations 2 & 5) with more abundant species have more weight, and become even more important when $q$ is greater. When $q$ is negative we have the opposite pattern: less abundant species have more weight in the sum, and so $D_q$ reflects the change of rare species. When $|q|$ is larger, $D_q$ is driven by more and more extreme values, and thus $D_q$ will have higher variance because extreme values are rarer. Here I present most figures with a range of $q$ from -24 to 24, but for statistical comparisons I use a smaller range (from -10 to 10) to avoid large variances.

Thus for negative $q$ values (i.e., the left side of the curves in Figure 2), $D_q^{SAD}$ characterizes the scaling of less abundant species---but we don't know exactly which species, as the curvature of $D_q^{SAD}$ when approaching $D_{-\infty}$ depends on the species abundances of the less abundant species, and we don't know exactly how the abundances and spatial patterns of these will influence the shape of $D_q^{SAD}$. $D_q^{SRS}$ also reflect the spatial patterns of the less abundant species, and the quantity $D_{-\infty}$ can be independently calculated [@Borda-de-Agua2002] and used to study rare species from the point of view of SAD and SRS; this is a different possible application of generalized dimensions. The positive part of the $D_q$ spectra characterizes the most abundant species for both SAD and SRS, but again it is unknown exactly how the shape of SAD, or its spatial pattern, will change the curvature of $D_q$. In this case the quantity $D_{\infty}$ characterizes the most abundant species, and its relationship with $D_{-\infty}$ could give information about the relation of dominant and rare species. Thus the range of $D_q$ provides important information, but the shape of the spectrum is also necessary to characterize the scaling of SAD or SRS. 


### Generalized dimension relationship with spatial patterns and SADs

I simulated species' spatial patterns with different SADs to demonstrate how $D_q$ is related to them. First I generated a uniform SAD, in which all species have approximately the same densities, by taking the number of individuals of each species from a Poisson distribution with the same mean. I distributed them in bands over a spatial grid so they formed a regular spatial pattern, in which each grid position is occupied by exactly one individual. I chose the number of species to exactly divide the side of the grid so all species are strips with approximately the same width (Figure 1).
I used square grids with sides of 256 and 512 sites containing 65536 and 262144 individuals respectively, and 8, 64 and 256 species, and then calculated $D_q$ for the regular pattern, randomizing the positions of species to compare $D_q$ obtained with these two extreme cases.
The second SAD used was a Logseries [@Fisher1943] with the same number of species and the same sides as above. I used the R package untb [@Hankin2007] to calculate the density for each species; this basically uses a Poisson distribution with the expected Logseries abundances as means. I then built the regular pattern with strips of species, but as species have different abundances, the widths for each species are different (Figure 1). I then estimated $D_q$ for the regular and randomized patterns, simulated 10 spatial patterns for each case, and calculated the mean and standard deviation of $D_q$. 

### Spatially explicit model

To simulate more realistic patterns of species-abundance-area relationships I used a stochastic spatially explicit model. For this I developed a stochastic cellular automata [@Molofsky2004] model that can switch between neutral or hierarchical competition, representing a continuum between niche and neutral communities [@Gravel2006]. Under neutral competition individuals do not interact, and all have the same mortality, colonization rates, and dispersal distances; in spite of these gross simplifications neutral models are capable of predicting several real community patterns [@Rosindell2011]. At the other end of the continuum are niche communities represented by hierarchical competition models [@Tilman1994]. In this case species have differences that imply a competitive hierarchy, in which some species are always better than others, producing competitive exclusion [@Chave2002]. I added a probability of replacement $\rho$ to the neutral model: when $\rho=1$ more competitive species always replace less competitive and the model behaves as a pure hierarchical one, and when $\rho=0$, there is no replacement of species and the model is completely neutral. A more thorough description of the model is given in appendix A, and its C++ source code is available at <https://github/lasaravia/neutral> and figshare <http://dx.doi.org/10.6084/m9.figshare.969692>. 

Following a classical neutral scheme the model has a metacommunity: a regional collection of communities. With probability *m* an individual of a species *i* can migrate from the metacommunity at a rate proportional to its frequency $X_i$ in the metacommunity. Species can also disperse locally, and the model assumes an exponential dispersal kernel with average dispersal distance $d$. Other model parameters are the mortality rate $\mu$, the number of species in the metacommunity, and the size of the community, represented as the *side* of the grid used in the simulations. I used a logseries SAD for the metacommunity, defined by the maximum number of individuals (*side x side*) and the number of species [@Fisher1943].  To represent a competition colonization trade-off I chose the most competitive species to be less abundant in the metacommunity. Parameters values were in the range estimated for BCI from the existing literature [@Anand2010; @Condit2002; @Etienne2007]. 

I performed 50 simulations for each combination of parameters given in Table 2. To compute the statistical power I made comparisons of communities with different levels of $\rho$, representing more neutral or hierarchical communities, in which the other parameters were kept constant. I also made comparisons between repetitions with the same $\rho$ to calculate the type I error.

### Statistical comparison of methods

I analyzed the performance of two kinds of methods to differentiate communities. The first consists of a set of points or curves: species abundance distributions (SAD), generalized dimensions $D_q^{SAD}$ and $D_q^{SRS}$. I am testing here for differences between two communities, thus I do not have information about the variability in $D_q$ for each $q$ or in abundance of each species, instead assuming that the sample comes from an unspecified univariate distribution. For these I used a permutation procedure with the k-sample Anderson-Darling (AD) statistic [@Scholz1987]. The AD statistic measures the differences between the empirical distribution functions (EDF) of two datasets as a weighted sum of square deviations between the EDFs [@Feigelson2012]. This means that the information about $q$ is lost, but as $D_q$ spectrum is continuous and non-increasing ---with the previously mentioned anomalies in $D_q^{SAD}$--- the shape of the curve is mirrored in the EDF; this is why the method can be used. For species abundance distributions the EDF is equivalent to the rank abundance distribution (RAD) [@Newman2005], and thus I am really comparing RADs with this method.
I calculated p-values using 1000 permutations, in all cases using the package kSamples [@Scholz2012] in the R statistical statistical language [@RCoreTeam2014]. Scripts for all analyses are available at github <https://github.com/lsaravia/SpeciesRankSurface> and figshare <http://dx.doi.org/10.6084/m9.figshare.1276105>.

The second kind of comparison method is based on a single dimension or power exponent: the SAR exponent and the information dimension. The SAR exponent is part of the $D_q^{SAD}$ spectra when $q=0$ [@Borda-de-Agua2002]; an equivalent single number measure from $D_q^{SRS}$ is the information dimension [@Ricotta2000;@Chappell2001], that is the $D_q^{SRS}$ when $q=1$. I calculated the power of these with a T-test using the standard deviation (SD) obtained from the box-counting regressions. These SD values are obtained with autocorrelated data, because small squares are nested within big squares (see Multifractal Analysis ). The consequence is that the SD may be underestimated, but it has been shown that the slopes estimates are still unbiased [@Kutner2005]. This should result in an increased type I error rate and also in a spurious increase in statistical power. This power calculation, based on one dimension, should be lower than the power for the complete spectra, and I wanted to whether this simpler and less computationally intensive method give good results when comparing different communities. In at least some cases, autocorrelation does not have significant consequences [@Legendre2002], and it is thus valuable to to investigate the influence of autocorrelation in these single dimensions. 

### Calculation of power and type I error

I simulated communities with different degrees of neutral/hierarchical structure, given by the parameter $\rho$ of the model. The power of a test is the ability to reject the null hypothesis ($H_0$) when false. The significance level to reject $H_0$ was set *a priori* at $\alpha$ = 0.05 in all cases, and the rejection rate of each test was calculated as the proportion of P values that less than or equal to $\alpha$. To estimate power I used independent simulations of communities (50 repetitions) with the same parameters except $\rho$.

The type I error is the probability of rejecting $H_0$ when it is true (false positive). In our simulations, $H_0$ is true if two simulated communities have the same $\rho$ (and also are equal in the other parameters). To estimate type I error I compared independent simulations of communities with the same set of parameters (50 repetitions) and computed the proportion of rejection.  


# Results

## Simple spatial patterns and SAD

I calculated two versions of $D_q$: a) the original definition due to Borda-de-Água et al.[-@Borda-de-Agua2002], where $D_q$ measures the change in SAD as we change scale ($D_q^{SAD}$), and b) $D_q$ based on SRS, which measures the change in the spatial distribution of species' ranks as scale changes ($D_q^{SRS}$). $D_q$ measures the rate of change with scale from a baseline that is defined by $D_0$. When we study SAD, $D_0^{SAD}$ is the SAR exponent and its value is around 0.5. A spatial distribution of species that duplicates its number with a duplication of the side of the area studied has a value of exactly 0.5. When we study SRS the $D_0^{SRS}$ is the fractal dimension of the spatial distribution of species. Note that in the simulations here, the individuals completely fill the available space, and thus $D_0^{SRS}$ is equal to 2. 

For the uniform SAD we expected $D_0^{SAD}$ to be around 0.5, following a symmetric pattern around $q=0$, as all species have the same abundance and occupy the same area. The symmetric pattern was not observed in the regular cases (Figure 2) because the negative part ($q<0$) analyzes numbers close to 0 and the logarithm (equation 5) enhances the differences between small numbers [@Laurie2011]. Thus the difference $\Delta D_q = \mid D_q - D_0\mid$ is greater for $q<0$. 

Theoretically $D_q$ should be decreasing or constant, but this was not observed in $D_q^{SAD}$ for the randomized spatial patterns with few species. This is because when changing scales, there is a point at which no new species are found, and the scaling relationship breaks. Figure 3 shows the scaling of $Z_{q}(\epsilon)$ fitted using linear regression for 64 species and a side=256 sites. The scaling for a randomized pattern $D_q^{SAD}$ breaks at 1.2, equivalent to a box with side 16 or an area of 256 units. In contrast, the scaling for the regular pattern $D_q^{SAD}$ shows oscillations around the fitted line but no evidence of breaks. When the number of species is high (256), the $D_q^{SAD}$ is similar to the randomized one (Figure 2); this happens because new species appear in the whole range of scales used. 

The $R^2$ values (Appendix table 1) indicate the presence of poor fits or a scaling break. The $D_q^{SAD}$ for randomized patterns and uniform SAD have the lowest $R^2$ of all cases. Based on all simulations I observe that the cases with the following conditions do not present anomalies: 90% of $D_q$ should have an $R^2$ of 0.6 or greater, and 50% should have an $R^2$ of 0.9 or greater (Appendix table 1); but one always should check the plots of the fits (Figure 3) and eventually change the $\epsilon$ range. Several patterns fail to comply with these conditions: for example, all the uniform randomized patterns, and the logseries randomized with 8 species (Appendix table 1 and Appendix figures 4-8), and these can be used as a guide to determine when the method can be applied. 

The $D_q^{SAD}$ for logseries had a more symmetric pattern than for uniform SAD (Figure 2), and exhibited better fits with higher $R^2$ (Figure 3). Comparing regular and randomized spatial patterns, the $D_q^{SAD}$ curves were superimposed on, or inside, the SD of the other curve. Thus it seems that $D_q^{SAD}$ cannot distinguish between such patterns (although this only considers the cases with good fits). Moreover the range of $D_q^{SAD}$ did not change very much with the number of species, as $D_q^{SAD}$ seems to depend mostly on the SAD used to generate the spatial pattern.

For $D_q^{SRS}$ the theoretical decreasing pattern was fulfilled in all cases, and no anomalies were observed (Figure 2). As in the previous case, an asymmetrical pattern was observed with $D_q^{SRS}$ around 2, an asymmetry more pronounced for patterns with uniform SAD than for logseries SAD. This is because logseries SAD have one very abundant species, with several less abundant and rare species scattered through the pattern (Figure 1), and thus the abundant species dominated the spatial pattern and in some cases produced a greater $\Delta D_q = \mid D_q - D_0\mid$ in the positive side of the plot (Figure 2, 8 Species). 

The uniform SAD produced $D_q^{SRS}$ with higher $\Delta D_q$ values for regular patterns when $q<0$. This is because the species are aggregated in the regular pattern, whereas in the randomized pattern there is no aggregation, so $D_q^{SRS}$ is closer to two. Thus $D_q^{SRS}$ for regular and randomized are more different on the negative side, and more similar on the positive side. For logseries SAD, the differences in $D_q^{SRS}$ are similar at negative or positive sides of $q$. In general $D_q^{SRS}$ curves for different spatial patterns and different SADs are distinct, except in some cases with 8 species, the curves for which are inside the SD of a different pattern.

The $R^2$ values for $D_q^{SRS}$ were all >0.9, higher than $D_q^{SAD}$, and all complied with the conditions described above (Appendix table 1). Their linear trends were also better (Figure 3). An example of linear trends for different number of species and different SADs is shown in the appendix (Appendix figures 4-8). The same qualitative patterns of $D_q^{SAD}$ and $D_q^{SRS}$ were observed for simulations with side=512 (Appendix figure 1).


## Simulated Neutral communities

Examples of the patterns simulated by the Neutral/hierarchical model are shown in Figure 4. By definition, hierarchical communities have more competitive species with lower index numbers, and neutral communities have more abundant species with higher index numbers, as determined by metacommunity abundance (see Methods and model description in the Appendix). With a greater degree of competitive hierarchy, one or few species dominate and several rare species are scattered over the landscape (Figure 5). This produces a mostly uniform pattern of dominant species with rare species distributed at random. In neutral communities the most abundant species are not so dominant (Figure 5), and leave space for species with intermediate abundances, producing a pattern of several aggregated species. Aggregation is produced in this model only because dispersal is mainly near the parent. 

For both estimated $D_q$ the $R^2$ values were very good: $D_q^{SRS}$ was always $R^2$>0.9 and $D_q^{SAD}$ had in almost all cases $R^2$>0.6 and a 50% or more of the cases greater than 0.9 (Appendix table 2). Figure 6 shows an example of $D_q$ fitted using linear relationships for a metacommunity of 86 species and a side of 256 sites; examples with different metacommunity species and side values are given in the appendix (appendix figures 9-13).

There are two groups of $D_q^{SAD}$ (Figure 7): one composed of neutral-like communities for $\rho < 0.1$, and another of more hierarchical communities for $\rho >0.1$. The curves for hierarchical communities were more separated for negative $q$ than for positive $q$, whereas this pattern was inverted in neutral communities, with positive $q$ having more different curves. This reflects the patterns in SAD: hierarchical communities have one or few relatively abundant species, resulting in $D_q^{SAD}$ reaching 0 quickly, and no new abundant species are found when changing scale. Neutral communities have more species with intermediate densities, producing $D_q^{SAD} > 0$ on the positive side. 

In theory $D_q$ have a constant value when $q$ tends to infinity (negative or positive). Here, $D_q^{SAD}$ spectra quickly reached a constant maximum for negative $q$ and a minimum for positive $q$. This pattern was more pronounced with hierarchical communities, which tended to have dominant species reflected on the positive side, and rare species on the negative. When communities are more neutral ($\rho < 0.1$) and there are more species with intermediate densities, $D_q^{SAD}$ tended to reach the asymptotic values more slowly in the negative side.  

For $D_q^{SRS}$ similar groups of neutral or hierarchical communities were also present (Figure 7). We previously saw that $D_q^{SRS}$ is more related to the spatial pattern than is $D_q^{SAD}$, and thus we can interpret $D_q^{SRS}$ in terms of randomness and aggregation of species. For hierarchical communities, negative-side $D_q^{SRS}$ is very close to 2, i.e. the dimension of a uniform surface, with rare species exerting a very low influence on uniformly-distributed dominants. For neutral communities there are more species with low to medium densities, with greater aggregation, and thus $D_q^{SRS}$ is higher. 

When $q$ is positive, lower values of $D_q^{SRS}$ mean more-intense spatial patterns. Communities with $\rho=1$ are the most hierarchical, with one dominant species and a few very rare species (Figure 6). For these communities $D_q^{SRS}$ is closer to 2, representing the uniform spatial distribution of dominant species. When the metacommunity has more species the local community also has more species (Appendix table 3) and  $D_q^{SRS}$ starts to deviate from 2 at lower $q$. $D_q^{SRS}$ for the intermediate hierarchical case ($\rho=0.1$) starts higher than neutral at $q$ near 0, but  crosses neutral curves and ends in the lowest place. The communities have more species that also are more abundant. but still have few individuals; this forms very sharp peaks in the SRS and produces a $D_q^{SRS}$ farther from 2. The curvature of $D_q^{SRS}$ is thus more pronounced when there are more species. 
For $\rho$ less than 0.1 communities are more neutral and have more species with similar densities, forming softer valleys and peaks that result in a $D_q^{SRS}$ intermediate between the two hierarchical cases. Simulations with side=512 exhibited similar patterns for $D_q$ (Appendix figure 14).


## Statistical Power and type I errors 

To calculate the power of the methods I compared communities with different $\rho$ values; in this comparison the alternative hypothesis is true. Instead for estimating type I error, we need to compare different runs of communities simulated with identical parameters. I talk of high power when its value is 0.75 or higher, and low power when it is 0.5 or lower.

For $D_q^{SAD}$ and $D_q^{SRS}$ different ranges of $q$ can be used. High values of $q$ in absolute terms should produce $D_q$ with high variances, resulting in a higher spread of values obtained in different simulation runs. Ranges of $q$ between -10 and 10 or narrower are generally used [@Saravia2012; @Wei2013;@Laurie2011;@Yakimov2008] but sometimes the applied range has been wider [@Saravia2012a]. I started using a $q$ range of -24 to 24, and found that for this range type I error rates were, in all cases, higher than the nominal significance level $\alpha = 0.05$ (Appendix table 4). As a statistical test is valid if the type I error is lower or equal to $\alpha$ [@Edgington1995], to assure the validity for these methods a narrower range should be used. I thus used a $q$ range between -10 and 10.

Using only one dimension of the spectra ($D_0^{SAD}$ and $D_1^{SRS}$) resulted in a power generally below 0.5 (Table 3) and a type I error around 0.4. These high type I error values, much greater than $\alpha$, were expected due to the presence of spatial autocorrelations in the dependent variable [@Legendre2002]. Parameter estimates can be corrected in different ways [@Legendre2002], but these procedures should not increase the power of $D_0^{SAD}$ and $D_1^{SRS}$.  

For communities with lower species numbers (11 species in the metacommunity) the SAD comparisons had a constant low power (Table 4) and also had low power comparing communities with different degree of neutrality (Figure 8); as the number of points used in the test is the number of species, the power is low thus no matter how different the communities are. In contrast, the generalized dimensions $D_q^{SAD}$ and $D_q^{SRS}$ had a high power, but Type I errors also greater than $\alpha$. One way to alleviate this problem is to check for a coincidence of the two methods SAD & $D_q$; another would be to increase the number of points used inside the $q$ range, because $D_q$ can be calculated for any real number. Here I used 21 points (Table 4) but that could be increased, as the only restriction is the additional computational time required. In simulated communities with more species (86 & 341 species metacommunity) the type I error fell below $\alpha$ for all the methods and the overall SAD was slightly more powerful (table 4). 

Differences between communities influence power (Figure 8). Note that with $\rho<0.1$, the communities compared are more neutral with a similar number of species and SADs. These cases correspond to the first two rows of Figure 9; the power in most cases was below 0.5, and thus $D_q^{SAD}$ and $D_q^{SRS}$ could not discriminate communities. The exception was SAD for neutral communities, where the metacommunity had 341 species, and the power was near or greater than 0.5. These are comparisons with a higher number of points (~100) resulting in a greater power. 

Communities with $\rho>=0.1$ are more hierarchical and have different numbers of species and SAD than communities with $\rho<0.1$. For these cases (last 2 rows of figure 8), the power was high (over 0.75) in most cases. The comparison between more hierarchical communities $\rho=0.1 >=0.1$, is different: SAD and  $D_q^{SAD}$, had less power (below 0.25 in some cases), and $D_q^{SRS}$ had the highest power. 

   
# Discussion

In this paper I present a new macroecological metric $D_q^{SRS}$ based on generalized dimensions, and use model simulations to compare it with other similar metrics: $D_q^{SAD}$, SAD, SAR exponent and information dimension.  

While $D_q^{SAD}$ measures the change in species abundance distribution with scale, $D_q^{SRS}$ represents the change in the spatial distribution of ranks of species, and is thus related to the spatial pattern of species and to their abundance distribution. $D_q^{SAD}$ also reflects changes in spatial pattern, but my results suggest that it cannot distinguish between regular and randomized spatial patterns. In contrast, $D_q^{SRS}$ curves differed clearly between these patterns. 

All $D_q$ curves can be interpreted in terms of $q$, a parameter that modulates the weight of abundant and rare species in the distribution; $D_q$ for positive $q$ reflects more abundant species, or dominance patterns in SAD, while $D_q$ for negative $q$ represents rare species patterns. An alternative way to analyze $D_q$ would be to split species into ranges of abundances and calculate $D_0^{SAD}$ or $D_1^{SRS}$. This has been done for biomass and forest height spatial analyses [@Seuront2002;@Kellner2009], but for species distributions it has several drawbacks. First, the species' spatial distribution is analyzed as a whole, and it is quite possible that the complete set of species fits power laws very well, but one or more single species do not [@Sizling2004]. Second, rare species represent a few points in space, and thus the estimation of $D_q$ will have a high uncertainty. Third, if we replace $q$ by ranges of abundance the theory developed for $D_q$ would not be valid [@Harte2001].   

In neutral models, the SAR exponent depends on speciation rate (in this case migration from a metacommunity), dispersal distance, and local community size [@Rosindell2007; @Chave2002;  @Cencini2012]. I did not expect to find high statistical power using the SAR exponent ($D_0^{SAD}$) because I did not vary migration or dispersal, and did not make comparisons between different community sizes. But I found high type I error rates for $D_0^{SAD}$ and $D_1^{SRS}$. This means that the statistical methods should be improved, for instance by applying a correction for autocorrelation to lower type I errors, and using a greater number of boxes. In most cases, a range of different $D_q$ values exists, meaning that the distribution is a multifractal [@Stanley1988] and thus will not be well described by only one generalized dimension. To compare communities, $D_q^{SRS}$ and $D_q^{SAD}$ represent an improvement over comparisons made with such as SAR exponent or information dimension, which use only one dimension. 

The species abundance distribution SAD is the most studied biodiversity pattern in ecology, but it is generally studied only at one scale. Here I used the whole simulation area, and at this scale the power of SAD is comparable to that of generalized dimensions. Several studies regard SAD as not very informative because many different models can produce the same patterns [@Chave2002; @Rosindell2013], but in my simulations SAD could differentiate models quite well, except for communities with low richness, where its power was low. Generally, the performance of SAD depends on the number of species used in the comparison. When the number of species is around 100, SAD comparison is the only method that can detect differences between very similar neutral communities.  

The analysis comparing competitive hierarchical communities highlights the ability of $D_q^{SRS}$ to detect differences in spatial patterns of rare species. Spatial pattern is interdependent with the shape of SAD; for hierarchical communities there are few dominant species that form patches with sizes similar to the simulation area, and rare species are scattered. This pattern is enhanced by SRS, and thus different communities can be detected with high power. For neutral communities the SAD is more equitable, as there are more species with enough abundances to form species clusters. $D_q^{SAD}$ and $D_q^{SRS}$ thus have a high power to detect differences between neutral communities, except when these communities are very similar. The advantage of $D_q$ over SAD it is that the power should be improved by using a greater number of $q$ values, and this possibility should be the subject of future studies.

In summary, $D_q^{SRS}$ always had better fits than $D_q^{SAD}$ and can be applied in all the cases simulated here. It maintained a high power comparing hierarchical communities when the other methods failed. SADs also exhibited good performance, except in a few cases noted above. I note however that a better approach could be to use both $D_q^{SRS}$ and SAD, and perhaps add other patterns as well [@Munkemuller2012]. For these reasons this new macroecological metric could be a valuable addition to the already established ones, and should be used in the study of the scaling of SAD [@Rosindell2013; @Borda-de-Agua2012]. 
 

# Acknowledgments

I am grateful to the National University of General Sarmiento for financial support, to Graeme Ruxton and Ben Bond-Lamberty for their English revisions. 

# References  
